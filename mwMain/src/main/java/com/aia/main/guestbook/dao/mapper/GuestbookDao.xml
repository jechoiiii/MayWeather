<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.aia.main.guestbook.dao.GuestbookDao">
	
	<!-- Guestbook 타입의 resultMap : 방명록 게시판 (A의 방명록) -->
	<resultMap id="guestbookResultList"
				type="com.aia.main.guestbook.domain.Guestbook">
		<id column="ownerNo" property="ownerNo"></id>
		<result column="gbookNo" property="gbookNo"/>
		<result column="writerNo" property="writerNo"/>
		<result column="writerName" property="writerName"/>
		<result column="writerPhoto" property="writerPhoto"/>
		<result column="writerLoc" property="writerLoc"/>
		<result column="content" property="content"/>
		<result column="contentPhoto" property="contentPhoto"/>
		<result column="regDate" property="regDate"/>
		<result column="updateDate" property="updateDate"/>
		<result column="secret" property="secret"/>
	</resultMap>
	
	<!-- Guestbook 타입의 resultMap : 방명록 게시물 (B가 남긴 방명록 1개) -->
	<resultMap id="guestbookResult"
				type="com.aia.main.guestbook.domain.Guestbook">
		<id column="gbookNo" property="gbookNo"></id>
		<result column="ownerNo" property="ownerNo"/>
		<result column="writerNo" property="writerNo"/>
		<result column="writerName" property="writerName"/>
		<result column="writerPhoto" property="writerPhoto"/>
		<result column="writerLoc" property="writerLoc"/>
		<result column="content" property="content"/>
		<result column="contentPhoto" property="contentPhoto"/>
		<result column="regDate" property="regDate"/>
		<result column="updateDate" property="updateDate"/>
		<result column="secret" property="secret"/>
	</resultMap>
	
	<!-- 방명록 게시물 총 수 -->
	<select id="selectGuestbookTotalCount" resultType="int">
		select count(*) from guestbook
	</select>
	
	<!-- 방명록 게시물 전체 리스트 조회 -->
	<select id="selectAllGuestbook"
			parameterType="map"
			resultMap="guestbookResult">
		select * from guestbook
	</select>

	<!-- 회원 A의 방명록 게시판 조회 : ownerNo로 조회 -->
	<select id="selectMemberGuestbook"
			parameterType="int"
			resultMap="guestbookResultList">
		select * from guestbook where ownerNo=#{ownerNo}
	</select>
	
	<!-- 회원 A의 방명록 게시판의 게시물 총 수 -->
	<select id="selectMemberGuestbookCount" resultType="int">
		select count(*) from guestbook where ownerNo=#{ownerNo}
	</select>
	
	<!-- 1개의 방명록 게시물 조회 -->
	<select id="selectGuestbookByGbookNo"
			resultMap="guestbookResult">
		select * from guestbook where gbookNo=?
	</select>
	
	
	
	<!-- 게시물 등록 -->
	<insert id="insertGuestbook"
			parameterType="com.aia.main.guestbook.domain.Guestbook"
			useGeneratedKeys="true"
			keyProperty="gbookNo">
		insert into guestbook
		
		<if test="contentPhoto == null">
			(ownerNo, writerNo, writerName, writerPhoto, writerLoc, content, secret)
			values
			(#{ownerNo},#{writerNo},#{writerName},#{writerPhoto},#{writerLoc},#{content},#{secret})
		</if>
		
		<if test="contentPhoto != null">
			(ownerNo, writerNo, writerName, writerPhoto, writerLoc, content, contentPhoto, secret)
			values
			(#{ownerNo},#{writerNo},#{writerName},#{writerPhoto},#{writerLoc},#{content},#{contentPhoto},#{secret})		
		</if>
	
	</insert>

	<!-- 회원 A의 방명록 게시판의 게시물 수 +1  -->
	<update id="">
		update guestbook_count set guestbookCount = guestbookCount+1;
	</update>

	
	<!-- 게시물 삭제  -->
	<delete id="deleteGuestbookByGbookNo">
		delete from guestbook where gbookNo=#{gbookNo}
	</delete>
	
	
	
	<!-- 게시물 수정 -->
	<update id="updateGuestbook"
			parameterType="com.aia.main.guestbook.domain.Guestbook">
		update guestbook
		set content=#{content},
			contentPhoto=#{contentPhoto},
			updateDate=#{updateDate},
			secret=#{secret}
		where gbookNo=#{gbookNo}
	
	</update>	
	
</mapper> 
